<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Clinic Hero | Fix Final v1.6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-slate-900 h-screen flex items-center justify-center font-sans">

    <div id="setup-card" class="bg-white p-10 rounded-3xl shadow-2xl w-96 text-center">
        <div class="bg-blue-600 w-16 h-16 rounded-2xl flex items-center justify-center text-white font-bold text-2xl mx-auto mb-6">CH</div>
        <h1 class="text-xl font-bold mb-8 text-slate-800">Portal Clinic Hero</h1>
        
        <div class="space-y-3">
            <button onclick="entrarApp('medico')" class="w-full bg-slate-800 text-white py-4 rounded-xl font-bold hover:bg-slate-700 transition">Acesso Médico</button>
            <button onclick="entrarApp('secretaria')" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 transition">Acesso Recepção</button>
        </div>
        <p id="db-msg" class="mt-6 text-[10px] text-slate-400 uppercase italic">Aguardando comando...</p>
    </div>

    <div id="app" style="display:none" class="fixed inset-0 bg-slate-50 flex flex-col">
        <header class="h-14 bg-white border-b px-6 flex items-center justify-between shadow-sm font-bold text-blue-600">
            CLINIC HERO
            <button onclick="location.reload()" class="text-xs text-slate-400">SAIR</button>
        </header>
        <div class="flex flex-1 overflow-hidden">
            <aside class="w-64 bg-white border-r p-4" id="nav-area"></aside>
            <main class="flex-1 p-8 overflow-y-auto" id="view-area"></main>
        </div>
    </div>

    <script>
        // Configurações
        const SB_URL = "https://ptcntqkmeypufwjrknyt.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0Y250cWttZXlwdWZ3anJrbnl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1Mzg3NjAsImV4cCI6MjA4MzExNDc2MH0.GPK2aNE9LYBBLVzFq7SVldhE0rzkXI3teYfwwh7TMtk";
        
        let supabaseClient = null;

        // Inicialização Segura
        window.onload = function() {
            try {
                if (window.supabase) {
                    supabaseClient = window.supabase.createClient(SB_URL, SB_KEY);
                    document.getElementById('db-msg').innerText = "Banco de Dados Pronto";
                }
            } catch (e) {
                document.getElementById('db-msg').innerText = "Erro ao carregar banco";
            }
        };

        function entrarApp(perfil) {
            // Esconde login e mostra app usando display puro do navegador
            document.getElementById('setup-card').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            
            const nav = document.getElementById('nav-area');
            const view = document.getElementById('view-area');

            if(perfil === 'medico') {
                nav.innerHTML = '<button class="w-full text-left p-3 rounded-xl bg-blue-50 text-blue-600 font-bold">Atendimento</button>';
                view.innerHTML = '<h2 class="text-2xl font-bold">Área do Médico Full-Service</h2><p>Pronto para iniciar.</p>';
            } else {
                nav.innerHTML = '<button onclick="abaCadastro()" class="w-full text-left p-3 rounded-xl bg-blue-50 text-blue-600 font-bold">Novo Cadastro</button>';
                abaCadastro();
            }
        }

        function abaCadastro() {
            document.getElementById('view-area').innerHTML = `
                <div class="max-w-md bg-white p-6 rounded-2xl border shadow-sm">
                    <h2 class="font-bold mb-4">Novo Paciente (Teste Supabase)</h2>
                    <input id="nome_paciente" placeholder="Nome completo" class="w-full p-2 border rounded mb-3 outline-none">
                    <button onclick="salvarNoBanco()" class="w-full bg-blue-600 text-white py-2 rounded font-bold">Salvar Agora</button>
                </div>
            `;
        }

        async function salvarNoBanco() {
            const nome = document.getElementById('nome_paciente').value;
            if(!nome) return alert("Preencha o nome");
            
            if(!supabaseClient) return alert("Banco não conectado!");

            const { error } = await supabaseClient.from('pacientes').insert([{ nome: nome }]);
            
            if (error) {
                alert("Erro: " + error.message);
            } else {
                alert("Sucesso! " + nome + " foi salvo.");
                document.getElementById('nome_paciente').value = '';
            }
        }
    </script>
</body>
</html>
