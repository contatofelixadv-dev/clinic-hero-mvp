<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Clinic Hero | Reset v1.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-slate-900 h-screen flex items-center justify-center font-sans">

    <div id="setup-card" class="bg-white p-10 rounded-3xl shadow-2xl w-96 text-center">
        <div class="bg-blue-600 w-16 h-16 rounded-2xl flex items-center justify-center text-white font-bold text-2xl mx-auto mb-6">CH</div>
        <h1 class="text-xl font-bold mb-8 text-slate-800">Portal Clinic Hero</h1>
        
        <div id="btn-group" class="space-y-3">
            <button onclick="entrar('medico')" class="w-full bg-slate-800 text-white py-4 rounded-xl font-bold hover:bg-slate-700 transition">Acesso Médico</button>
            <button onclick="entrar('secretaria')" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 transition">Acesso Recepção</button>
        </div>
        <p id="status-db" class="mt-6 text-[10px] text-slate-400 uppercase tracking-widest italic">Verificando banco...</p>
    </div>

    <div id="app" class="hidden fixed inset-0 bg-slate-50 flex flex-col">
        <header class="h-14 bg-white border-b px-6 flex items-center justify-between shadow-sm font-bold text-blue-600">
            CLINIC HERO
            <button onclick="location.reload()" class="text-xs text-slate-400">SAIR</button>
        </header>
        <div class="flex flex-1">
            <aside class="w-64 bg-white border-r p-4" id="nav"></aside>
            <main class="flex-1 p-8 overflow-y-auto" id="view"></main>
        </div>
    </div>

    <script>
        const URL = "https://ptcntqkmeypufwjrknyt.supabase.co";
        const KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0Y250cWttZXlwdWZ3anJrbnl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1Mzg3NjAsImV4cCI6MjA4MzExNDc2MH0.GPK2aNE9LYBBLVzFq7SVldhE0rzkXI3teYfwwh7TMtk";
        
        let supabase;
        
        // Tenta criar o cliente Supabase de forma segura
        try {
            supabase = window.supabase.createClient(URL, KEY);
            console.log("Supabase carregado.");
        } catch(e) {
            console.error("Erro ao carregar biblioteca:", e);
        }

        async function verificarBanco() {
            const statusLabel = document.getElementById('status-db');
            if (!supabase) {
                statusLabel.innerText = "Erro: Biblioteca não carregada";
                return;
            }
            try {
                const { data, error } = await supabase.from('pacientes').select('*').limit(1);
                statusLabel.innerText = error ? "Banco: Erro de Permissão" : "Banco: Conectado";
            } catch (e) {
                statusLabel.innerText = "Banco: Erro de Rede";
            }
        }

        // Verifica o banco em segundo plano, sem travar os botões
        window.onload = verificarBanco;

        function entrar(role) {
            document.getElementById('setup-card').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            const nav = document.getElementById('nav');
            const view = document.getElementById('view');

            if(role === 'medico') {
                nav.innerHTML = `<button class="w-full text-left p-3 rounded-xl bg-blue-50 text-blue-600 font-bold">Atendimento</button>`;
                view.innerHTML = `<h2 class="text-2xl font-bold">Módulo Médico Full-Service</h2><p class="text-slate-500">Pronto para iniciar consultas.</p>`;
            } else {
                nav.innerHTML = `<button onclick="renderForm()" class="w-full text-left p-3 rounded-xl bg-blue-50 text-blue-600 font-bold">Cadastrar Paciente</button>`;
                renderForm();
            }
        }

        function renderForm() {
            document.getElementById('view').innerHTML = `
                <div class="max-w-md bg-white p-6 rounded-2xl border shadow-sm">
                    <h2 class="font-bold mb-4">Novo Cadastro (Teste Real)</h2>
                    <input id="nome" placeholder="Nome do Paciente" class="w-full p-2 border rounded mb-2 outline-none focus:border-blue-500">
                    <button onclick="salvar()" class="w-full bg-blue-600 text-white py-2 rounded font-bold hover:bg-blue-700 transition">Salvar no Banco</button>
                </div>
            `;
        }

        async function salvar() {
            const n = document.getElementById('nome').value;
            if(!n) return alert("Digite um nome");
            
            const { error } = await supabase.from('pacientes').insert([{ nome: n }]);
            
            if (error) {
                alert("Erro ao salvar: " + error.message + ". Verifique o SQL Editor.");
            } else {
                alert("Sucesso! Paciente '" + n + "' salvo no Supabase.");
                document.getElementById('nome').value = '';
            }
        }
    </script>
</body>
</html>
