<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Clinic Hero | Reset v1.4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-slate-900 h-screen flex items-center justify-center font-sans">

    <div id="setup-card" class="bg-white p-10 rounded-3xl shadow-2xl w-96 text-center">
        <h1 id="msg" class="text-xl font-bold mb-6 text-slate-800">Conectando...</h1>
        
        <div id="loader" class="animate-spin h-8 w-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-6"></div>

        <div id="btns" class="hidden space-y-3">
            <button onclick="entrar('medico')" class="w-full bg-slate-800 text-white py-4 rounded-xl font-bold">Portal Médico</button>
            <button onclick="entrar('secretaria')" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold">Portal Recepção</button>
        </div>
        
        <button id="btn-force" onclick="forcar()" class="hidden mt-4 text-xs text-slate-400 underline">Forçar entrada sem banco</button>
    </div>

    <div id="app" class="hidden fixed inset-0 bg-slate-50 flex flex-col">
        <header class="h-14 bg-white border-b px-6 flex items-center justify-between shadow-sm font-bold text-blue-600">
            CLINIC HERO <button onclick="location.reload()" class="text-xs text-slate-400">SAIR</button>
        </header>
        <div class="flex flex-1 overflow-hidden">
            <aside class="w-64 bg-white border-r p-4" id="nav"></aside>
            <main class="flex-1 p-8 overflow-y-auto" id="view"></main>
        </div>
    </div>

    <script>
        const URL = "https://ptcntqkmeypufwjrknyt.supabase.co";
        const KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0Y250cWttZXlwdWZ3anJrbnl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1Mzg3NjAsImV4cCI6MjA4MzExNDc2MH0.GPK2aNE9LYBBLVzFq7SVldhE0rzkXI3teYfwwh7TMtk";
        const supabase = window.supabase.createClient(URL, KEY);

        async function verificar() {
            // Se em 7 segundos não responder, mostra o botão de forçar
            setTimeout(() => { 
                if(document.getElementById('btns').classList.contains('hidden')) {
                    document.getElementById('btn-force').classList.remove('hidden');
                    document.getElementById('msg').innerText = "O banco demorou a responder";
                }
            }, 7000);

            try {
                const { data, error } = await supabase.from('pacientes').select('*').limit(1);
                if (!error) {
                    document.getElementById('msg').innerText = "Sistema Online";
                    document.getElementById('loader').classList.add('hidden');
                    document.getElementById('btns').classList.remove('hidden');
                } else {
                    document.getElementById('msg').innerText = "Erro na Tabela";
                    console.log(error);
                }
            } catch (e) {
                document.getElementById('msg').innerText = "Erro de Rede";
            }
        }

        window.onload = verificar;

        function forcar() {
            document.getElementById('msg').innerText = "Modo Offline (Demo)";
            document.getElementById('loader').classList.add('hidden');
            document.getElementById('btns').classList.remove('hidden');
        }

        function entrar(role) {
            document.getElementById('setup-card').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            const nav = document.getElementById('nav');
            if(role === 'medico') {
                nav.innerHTML = `<button class="w-full text-left p-3 rounded-xl bg-blue-50 text-blue-600 font-bold">Atendimento</button>`;
                document.getElementById('view').innerHTML = `<h2 class="text-2xl font-bold">Área Médica</h2>`;
            } else {
                nav.innerHTML = `<button onclick="renderForm()" class="w-full text-left p-3 rounded-xl bg-blue-50 text-blue-600 font-bold">Cadastrar Paciente</button>`;
                renderForm();
            }
        }

        function renderForm() {
            document.getElementById('view').innerHTML = `
                <div class="max-w-md bg-white p-6 rounded-2xl border shadow-sm">
                    <h2 class="font-bold mb-4">Novo Registro</h2>
                    <input id="nome" placeholder="Nome" class="w-full p-2 border rounded mb-2">
                    <button onclick="salvar()" class="w-full bg-blue-600 text-white py-2 rounded font-bold">Salvar</button>
                </div>
            `;
        }

        async function salvar() {
            const n = document.getElementById('nome').value;
            const { error } = await supabase.from('pacientes').insert([{ nome: n }]);
            if (error) alert("Erro ao salvar no banco. Verifique o SQL Editor.");
            else alert("Salvo com sucesso!");
        }
    </script>
</body>
</html>
